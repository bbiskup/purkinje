sudo: required
dist: trusty
python:
  - "2.7"
cache:
  apt: true
  directories:
    - $HOME/data
    # Permission denied
    # - /var/lib/docker

before_install:
    - type docker
    - docker --version
    - type docker-compose
    - docker-compose --version

    - sudo apt-get update -yy
    - sudo apt-get install -yy make

install:
    - make stack-up

before_script:
    - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
    - docker pull bbiskup/purkinje_dev:latest || true

script:
   - make test
   - make doc

   - make build-docker-dist-img

after_success:
    #   make coveralls
    - docker tag -f purkinje_dev bbiskup/purkinje_dev:latest
    - docker tag purkinje_dev bbiskup/purkinje_dev:$TRAVIS_BUILD_NUMBER
    - docker push bbiskup/purkinje_dev:latest
    - docker push bbiskup/purkinje_dev:$TRAVIS_BUILD_NUMBER
